// AUTO-GENERATED BY generate-tests.ts
// Source: src/components/UserProfilePanel.tsx
// DO NOT EDIT MANUALLY - 修改将在下次生成时被覆盖

import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, test } from 'vitest';
import UserProfilePanel from '../../../src/components/UserProfilePanel';

describe('UserProfilePanel', () => {
  const defaultProps = {
    open: true,
    onClose: vi.fn(),
    email: 'test@example.com',
    preloadNodeModules: false,
    onTogglePreload: vi.fn(),
  };

  it('renders null when open is false', () => {
    render(<UserProfilePanel {...defaultProps} open={false} />);
    expect(screen.queryByText('个人信息')).toBeNull();
  });

  it('renders correctly when open is true', () => {
    render(<UserProfilePanel {...defaultProps} />);
    expect(screen.getByText('个人信息')).toBeInTheDocument();
    expect(screen.getByText(defaultProps.email)).toBeInTheDocument();
    expect(screen.getByLabelText('关闭')).toBeInTheDocument();
  });

  test.each([
    ['empty email', ''],
    ['long email', 'a'.repeat(200) + '@example.com'],
    ['special chars', '用户@例子.测试'],
  ])('displays email: %s', (_, email) => {
    render(<UserProfilePanel {...defaultProps} email={email} />);
    expect(screen.getByText(email)).toBeInTheDocument();
  });

  it('calls onClose when close button is clicked', () => {
    render(<UserProfilePanel {...defaultProps} />);
    const closeBtn = screen.getByLabelText('关闭');
    fireEvent.click(closeBtn);
    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);
  });

  describe('preload node_modules toggle', () => {
    it('checkbox reflects preloadNodeModules prop', () => {
      const { rerender } = render(
        <UserProfilePanel {...defaultProps} preloadNodeModules={false} />
      );
      const checkbox = screen.getByRole('checkbox') as HTMLInputElement;
      expect(checkbox.checked).toBe(false);
      rerender(
        <UserProfilePanel {...defaultProps} preloadNodeModules={true} />
      );
      expect(checkbox.checked).toBe(true);
    });

    it('calls onTogglePreload with new checked value when toggled', () => {
      render(<UserProfilePanel {...defaultProps} preloadNodeModules={false} />);
      const checkbox = screen.getByRole('checkbox') as HTMLInputElement;
      fireEvent.click(checkbox);
      expect(defaultProps.onTogglePreload).toHaveBeenCalledWith(true);
      fireEvent.click(checkbox);
      expect(defaultProps.onTogglePreload).toHaveBeenCalledWith(false);
    });
  });
});