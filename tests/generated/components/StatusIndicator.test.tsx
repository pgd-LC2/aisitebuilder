// AUTO-GENERATED BY generate-tests.ts
// Source: src/components/StatusIndicator.tsx
// DO NOT EDIT MANUALLY - 修改将在下次生成时被覆盖

import { render, screen, waitFor } from '@testing-library/react';
import { vi } from 'vitest';
import StatusIndicator from '../../../src/components/StatusIndicator';

describe('StatusIndicator', () => {
  beforeEach(() => {
    vi.useFakeTimers();
  });

  afterEach(() => {
    vi.clearAllTimers();
  });

  const statusSequence = [
    { key: 'ready', label: '就绪', color: 'bg-green-500', animate: true },
    { key: 'thinking', label: '思考中', color: 'bg-blue-500', animate: true },
    { key: 'building', label: '构建中', color: 'bg-yellow-500', animate: true },
    { key: 'idle', label: '空闲', color: 'bg-gray-500', animate: false },
  ];

  test('renders initial status as ready', () => {
    const { container } = render(<StatusIndicator />);
    const label = screen.getByText('就绪');
    expect(label).toBeInTheDocument();

    const dot = container.querySelector('.w-2');
    expect(dot).toHaveClass('bg-green-500');
    expect(dot).toHaveClass('animate-pulse');
  });

  test.each(statusSequence)(
    'updates status to %s after each interval',
    async ({ label, color, animate }) => {
      const { container } = render(<StatusIndicator />);
      // Advance timers by one interval (3000ms) to trigger status change
      vi.advanceTimersByTime(3000);

      await waitFor(() => {
        const lbl = screen.getByText(label);
        expect(lbl).toBeInTheDocument();
      });

      const dot = container.querySelector('.w-2');
      expect(dot).toHaveClass(color);
      if (animate) {
        expect(dot).toHaveClass('animate-pulse');
      } else {
        expect(dot).not.toHaveClass('animate-pulse');
      }
    }
  );

  test('cleans up interval when component is unmounted', () => {
    const { unmount } = render(<StatusIndicator />);
    unmount();
    // After unmount, advancing timers should not cause any errors
    vi.advanceTimersByTime(3000);
    expect(true).toBe(true);
  });
});