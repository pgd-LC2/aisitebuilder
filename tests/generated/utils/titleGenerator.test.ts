// AUTO-GENERATED BY generate-tests.ts
// Source: src/utils/titleGenerator.ts
// DO NOT EDIT MANUALLY - 修改将在下次生成时被覆盖

import { describe, it, expect, test } from 'vitest';
import { generateTitle } from '../../../src/utils/titleGenerator';

describe('generateTitle', () => {
  // ---------- basic behavior ----------
  it('returns "未命名项目" when input is empty or whitespace', () => {
    expect(generateTitle('')).toBe('未命名项目');
    expect(generateTitle('   ')).toBe('未命名项目');
  });

  // ---------- keyword extraction ----------
  test.each([
    ['一个简单的项目', '简单项目'],
    ['这是一个网站和应用的项目', '网站应用项目'],
    ['我想开发一个游戏', '游戏'],
    ['这是一个非常长的描述，包含了很多词语，但没有任何关键词', '这是一个非常长的描述，包含了...'],
    ['这是一条包含stopword的描述', '这条包含'],
    ['短', '短'],
    ['a b c', 'a'],
    ['   多   空格   ', '多'],
  ])('generates title for description "%s"', (desc, expected) => {
    expect(generateTitle(desc)).toBe(expected);
  });

  // ---------- stopwords and short words ----------
  test.each([
    ['的 是 就 都', '未命名项目'],
    ['我想开发', '开发'],
    ['我想', '未命名项目'],
    ['我想开发一个', '开发'],
  ])('handles stopwords and short words in "%s"', (desc, expected) => {
    expect(generateTitle(desc)).toBe(expected);
  });

  // ---------- project keyword appending ----------
  test.each([
    ['描述中包含网站但未提取', '网站'],
    ['描述中包含应用但未提取', '应用'],
    ['描述中包含平台但未提取', '平台'],
    ['描述中包含系统但未提取', '系统'],
    ['描述中包含游戏但未提取', '游戏'],
  ])('appends missing project keyword when "%s"', (desc, expected) => {
    const title = generateTitle(desc);
    expect(title).toContain(expected);
  });

  // ---------- length truncation ----------
  it('truncates title longer than 30 characters', () => {
    const longDesc = '这是一个包含多个关键词的非常长的描述，用于测试截断功能';
    const title = generateTitle(longDesc);
    expect(title.length).toBeLessThanOrEqual(30);
  });

  // ---------- edge cases ----------
  it('returns truncated description with ellipsis when no keywords found', () => {
    const desc = '这是一个没有任何关键词的长描述，长度超过二十个字符';
    const truncated = desc.trim().slice(0, 20) + '...';
    expect(generateTitle(desc)).toBe(truncated);
  });

  it('handles description with only one keyword and no project keyword', () => {
    const desc = '这是一个工具的描述';
    const title = generateTitle(desc);
    // '工具' is a keyword but not a project keyword, so it should be appended
    expect(title).toBe('工具');
  });

  it('does not append project keyword if already present in extracted keywords', () => {
    const desc = '这是一个网站的描述';
    const title = generateTitle(desc);
    // '网站' is both a keyword and a project keyword, so no extra append
    expect(title).toBe('网站');
  });

  // ---------- parameterized tests for various combinations ----------
  test.each([
    ['开发一个网站应用平台系统工具游戏', '开发网站应用平台系统工具游戏'],
    ['开发一个商城电商社交博客论坛在线企业个人课程作品', '开发商城电商社交博客论坛在线企业个人课程'],
    ['开发一个', '开发'],
    ['开发一个开发', '开发开发'],
    ['开发一个开发开发开发开发开发开发开发', '开发开发开发开发开发开发'],
  ])('generates correct title for complex description "%s"', (desc, expected) => {
    expect(generateTitle(desc)).toBe(expected);
  });
});