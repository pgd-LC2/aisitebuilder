# Prompts v3 - Chat 专用只读模式

## 版本说明

v3 版本引入了专门针对 `chat_reply` 任务的**只读分析模式**，解决了聊天模式下 AI 可能修改文件的问题。

## 主要变更

### 1. 新增 Chat 层级

- 新增 `chat` 层级，专用于 `chat_reply` 任务
- 该层级只提供只读工具能力，不包含任何文件修改工具
- 明确定义了 AI 的角色为"代码分析顾问"而非"代码构建器"

### 2. 提示词文件

| 文件 | 用途 |
|------|------|
| `chat.assistant.readonly.v3.md` | Chat 专用只读模式提示词，限制 AI 只能分析代码 |

### 3. 与 v2 的区别

| 特性 | v2 | v3 |
|------|----|----|
| chat_reply 工具能力 | 完整工具集 | 只读工具集 |
| chat_reply 层级 | 使用 core 层 | 使用专用 chat 层 |
| 文件修改能力 | 有（通过提示词约束） | 无（技术层面禁止） |

## 设计原则

v3 版本的核心设计原则是**硬约束优于软约束**：

1. **技术层面限制**：通过工具能力矩阵，在 API 调用层面就不暴露文件修改工具给 AI
2. **提示词层面引导**：明确告知 AI 其角色和能力边界
3. **用户引导**：当用户需要修改代码时，引导他们使用正确的工作流模式

## 使用说明

当 `ai_tasks.type = 'chat_reply'` 时，PromptRouter 会自动使用 `chat` 层级，加载 `chat.assistant.readonly.v3` 提示词。

---

*Last Updated: 2025-12-07*
